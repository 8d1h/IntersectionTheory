```@meta
CurrentModule = IntersectionTheory
DocTestSetup = quote
  using IntersectionTheory
end
```
```@setup repl
using IntersectionTheory
```
# Chern number computations
We gather some Chern numbers related computations here.

## Cobordism ring
Let $\Omega$ be the (complex) cobordism ring with rational coefficients. Milnor
showed that $\Omega$ is a polynomial ring freely generated by cobordism classes
of projective spaces. We implemented the interface `CobordRing` and
`CobordRingElem` to model $\Omega$ and its elements. The main application will
be the computation of Chern numbers for Hilbert schemes of points on a surface
and for generalized Kummer varieties.
```@docs
cobordism_ring
cobordism_class
```
```@repl repl
Ω = cobordism_ring()
Ω[1]
(1 + Ω[1])^2 + Ω[2]
Nemo.PolynomialRing(Ω, ["z"])[1]
```
The letter $\Omega$ can be typed using `\Omega[tab]` in Julia, and of course
one can use other letters.

We can plug in an `AbsVariety` or a `TnVariety` to construct the cobordism
class.
```@repl repl
K3 = complete_intersection(proj(3), 4)
Ω(K3)
cobordism_class(K3)
Ω(flag(1,2,3,bott=true))
```

Each cobordism class is uniquely determined by its Chern numbers and vice
versa, so we can perform conversions between a cobordism class and a dictionary
of Chern numbers.
```@docs
chern_numbers(x::CobordRingElem)
```
```@repl repl
chern_numbers(Ω(K3))
Ω(chern_numbers(K3))
```

For a top-degree expression in terms of the Chern classes, its integral depends
only on the Chern numbers, hence we can perform integration against a cobordism
class. We also show the usual integration in Chow ring as a comparison.
```@docs
integral(x::CobordRingElem, t::ChRingElem)
```
```@repl repl
integral(Ω[4], todd(4)),                     integral(todd(proj(4)))
integral(Ω[2]^2, sqrt(todd(4))),             integral(sqrt(todd(proj(2)*proj(2))))
integral(Ω(flag(1,2,3)), ch(variety(3).T)),  integral(ch(flag(1,2,3).T))
```

## Genus on the cobordism ring
An $R$-valued *genus* $\phi$ is a ring morphism from $\Omega$ to another ring
$R$. The *Todd genus* is a such example with $R=\mathbf Q$, which maps each
generator $[\mathbf P^k]$ to 1. Milnor showed that genera are in one-to-one
correspondence with formal power series in $R[[z]]$ with constant coefficient
1: for an $n$-dimensional complex manifold $X$, write $\gamma_i$ with $1\le
i\le n$ for the Chern roots of the tangent bundle of $X$, then the power series
$f_\phi\in R[[z]]$ satisfies

$$\phi([X]) = \int_X\prod_{i=1}^nf_\phi(\gamma_i).$$

For example, the power series for the Todd genus is the Taylor expansion of
$\frac{z}{1-\exp(-z)}$. One can also expand the product in the integrand in
terms of Chern classes of $X$: this gives one expression in each degree $n$.
We will refer to the sum of these expressions as the total class of the genus.
For Todd genus, we get the familiar

$$1+\tfrac12c_1+\tfrac1{12}(c_1^2+c_2)+\cdots$$

which we can also obtain using `todd(n)`.

```@docs
universal_genus
```
One particularly interesting genus is the identity $\mathrm{id}:\Omega \to
\Omega$, which we will call the *universal genus*. One would get a formal power
series $f_{\mathrm{id}}$ in $\Omega[[z]]$.
We can compute the first terms of this power series, as well as the total class
of the genus. We also verify that by taking the integral we indeed get the
identity.
```@repl repl
IntersectionTheory._taylor(4)
universal_genus(2)
integral(Ω[2], universal_genus(2))
```
One way to see the *universality* is to replace each cobordism class in the
total class by its Todd genus, then we recover the total Todd class given
above. More generally, one can compute the total class for an arbitrary genus
in this way.
```@repl repl
universal_genus(2, k -> QQ(1))
```

One can also twist a genus $\phi$ using the first Chern class $c_1$, and
obtain a new genus $\phi_t$

$$\phi_t([X]) := \int_X e^{t\cdot c_1(X)}\prod_{i=1}^nf_\phi(\gamma_i).$$

Here we compute the total class for the twisted genus $\mathrm{id}_1$.
```@repl repl
universal_genus(2, twist=1)
```

## Chern numbers of the Hilbert scheme of a surface
Let $S$ be a smooth projective surface.
[Ellingsrud--Göttsche--Lehn](https://arxiv.org/abs/math/9904095) showed that
the cobordism class of the Hilbert scheme $S^{[n]}$ of $n$ points on $S$
depends only on the cobordism class of $S$. In other words, the Chern numbers
of $S^{[n]}$ only depends on the Chern numbers of $S$, $c_1(S)^2$ and $c_2(S)$.
One can therefore consider the generating series

$$H([S])=H(S):=\sum_{n=0}^\infty\big[S^{[n]}\big]z^n\in\Omega[[z]].$$

Moreover, it is shown that

$$H(a_1[S_1]+a_2[S_2]) = H(S_1)^{a_1}\cdot H(S_2)^{a_2}.$$

On the other hand, the cobordism classes of surfaces are linearly generated by
$[\mathbf P^2]$ and $[\mathbf P^1\times \mathbf P^1]$, hence it will suffice to
compute only two generating series. For these two surfaces, their Hilbert
schemes admit natural torus actions, so the Chern numbers can be readily
computed using Bott's formula.

We provide the constructors for $(\mathbf P^2)^{[n]}$ and $(\mathbf P^1\times
\mathbf P^1)^{[n]}$ as `TnVariety`, which will allow the computation of their
Chern numbers using Bott's formula. Then we implement a function that computes
the cobordism class of $S^{[n]}$ for an arbitrary cobordism class $[S]$
specified by its two Chern numbers $c_1^2$ and $c_2$, using the strategy
described above.

```@docs
hilb_P2
hilb_P1xP1
hilb_surface
hilb_K3
```
### Examples
```@repl repl
X = hilb_P2(2)
chern_numbers(X)
hilb_surface(2, 0, 24)
hilb_K3(2)
chern_numbers(hilb_K3(2), nonzero=true)
integral(hilb_K3(2), sqrt(todd(4)))
```
We record the Chern numbers of $\mathrm{K3}^{[n]}$ with $n\in\{5,6,7,8\}$, since
these are not found in the literature.
```julia-repl
julia> chern_numbers(hilb_K3(5), nonzero=true)
Dict{AbstractAlgebra.Generic.Partition{Int64}, Nemo.fmpq} with 7 entries:
  10₁  => 176256
  6₁4₁ => 5075424
  6₁2₂ => 12168576
  8₁2₁ => 1774080
  4₁2₃ => 52697088
  2₅   => 126867456
  4₂2₁ => 21921408

julia> chern_numbers(hilb_K3(6), nonzero=true)
Dict{AbstractAlgebra.Generic.Partition{Int64}, Nemo.fmpq} with 11 entries:
  6₁4₁2₁ => 392090040
  8₁4₁   => 59314272
  8₁2₂   => 139942280
  12₁    => 1073720
  6₁2₃   => 927397840
  10₁2₁  => 14450680
  4₃     => 697106648
  2₆     => 9277276480
  4₁2₄   => 3910848640
  4₂2₂   => 1650311720
  6₂     => 93495320

julia> chern_numbers(hilb_K3(7), nonzero=true)
Dict{AbstractAlgebra.Generic.Partition{Int64}, Nemo.fmpq} with 15 entries:
  8₁6₁   => 1296158976
  10₁4₁  => 569044224
  10₁2₂  => 1324608768
  6₁2₄   => 79324710912
  6₁4₂   => 14528215296
  8₁4₁2₁ => 5296568832
  6₁4₁2₂ => 33935583744
  4₃2₁   => 59674012416
  2₇     => 765374164992
  4₁2₅   => 326732507136
  6₂2₁   => 8273055744
  4₂2₃   => 139582386432
  12₁2₁  => 102477312
  8₁2₃   => 12357114624
  14₁    => 5930496

julia> chern_numbers(hilb_K3(8), nonzero=true)
Dict{AbstractAlgebra.Generic.Partition{Int64}, Nemo.fmpq} with 22 entries:
  10₁2₃   => 133823975040
  8₁2₄    => 1205400258720
  4₂2₄    => 13094639681760
  8₁4₂    => 225987046020
  2₈      => 70277256403200
  14₁2₁   => 649511820
  4₁2₆    => 30327407026560
  8₂      => 21049285275
  6₁2₅    => 7517275416000
  8₁6₁2₁  => 130128762960
  10₁4₁2₁ => 58033047240
  6₁4₂2₁  => 1405173296520
  6₂4₁    => 349760996280
  12₁4₁   => 4678568010
  12₁2₂   => 10767198960
  16₁     => 30178575
  4₄      => 2445207931980
  8₁4₁2₂  => 521787430080
  6₁4₁2₃  => 3249219677760
  6₂2₂    => 807925003200
  10₁6₁   => 14525621460
  4₃2₂    => 5657019716880
```
## Chern numbers of the generalized Kummer varieties
By results of Nieper-Wißkirchen, the cobordism classes of generalized Kummer
varieties can be obtained using the generating series $H(S)$ for *one* surface
$S$ with $c_1(S)^2\ne0$, along with the values of $H(S)$ under the twisted
genus $\mathrm{id}_1$ and $\mathrm{id}_{-1}$. We take $S$ to be the projective
plane $\mathbf P^2$.

```@docs
generalized_kummer
```
### Examples
```@repl repl
generalized_kummer(2)
chern_numbers(generalized_kummer(2), nonzero=true)
```

## A polynomial defined by Libgober--Wood
[Libgober--Wood](https://projecteuclid.org/journals/journal-of-differential-geometry/volume-32/issue-1/Uniqueness-of-the-complex-structure-on-K%C3%A4hler-manifolds-of-certain/10.4310/jdg/1214445041.full)
defined a universal polynomial with coefficients in Chern numbers of an
$n$-dimensional compact Kähler manifold, which can be used to obtain
restrictions on certain topological invariants. They are computed up to
dimension 9 in this [survey](https://arxiv.org/abs/1512.04321).

We have a function to compute this polynomial. The dimension-10 one can be
computed in less than 1 second, and the dimension-16 one in about 1 minute.

Of course one can also compute the value of this polynomial for a specific variety.
```@docs
IntersectionTheory.libgober_wood_polynomial
```
### Examples
```@repl repl
libgober_wood_polynomial(3)
libgober_wood_polynomial(proj(6))
```
The degree-2 term is shown to depend on only two Chern numbers.
```@repl repl
[Nemo.coeff(libgober_wood_polynomial(n), 2) for n in 1:10]
```
We observe that there should be similar results for the degree-4 term.
```@repl repl
[Nemo.coeff(libgober_wood_polynomial(n), 4) for n in 1:10]
```
